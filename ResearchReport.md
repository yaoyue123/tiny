# 基于llvm的跳转基本块的划分
###### 2018302180148袁寰宇,	2018 302180149马陈军

  


## 1.概述

&emsp;&emsp;本项目是我们与李子昂同学(2018302180162) 等人在信安大赛参加的作品《神经网络分析二进制控制流图的间接跳转》的一个子项目。本项目的主要内容是利用LLVM这一工具，去寻找C语言源代码中的跳转基本块，并找到跳转基本块之间的对应关系。


## 2.LLVM相关技术的背景及现状

&emsp;&emsp;LLVM是伊利诺伊州大学的ChrisLattner在博士期间开发的一个编译器框架。其旨在优化以多种源程序语言编写的程序的编译时间、链接时间、运行时间以及空闲时间。其特点是支持多种源程序语言编译成为统一的LLVM IR从而进行统一的优化，在编译速度，中间代码占用空间和错误提示等方面比传统的GCC编译器做的更好。目前LLVM编译器已经成为美国苹果公司主流编译器，作为一个新生的编译器正在向GCC发起挑战，目前无论从科研角度还是实际用户，LLVM越来越被更多的开发者和用户所接受。

&emsp;&emsp;Clang编译器可以将多种编程语言的源代码进行编译，并生成LLVM特有的中间表示。这是LLVM开发的一款语言，应用于LLVM的中端处理，类似于汇编的虚拟指令集，旨在于帮助开发者分析程序和优化代码等。虽然LLVM中间表示属于低级表示的语言，但是通过指令组合可以支持高级语言的表示，再通过LLVM优化器Opt提供的Pass或者自行实现对应的程序分析的方法实现对程序的分析和转换。  

&emsp;&emsp;LLVM Pass是编译器中的一部分，能够对代码进行转化和优化。Pass就是“遍历一遍IR，可以同时对它做一些操作”的意思。翻译成中文应该叫“趟”。在实现上，LLVM的核心库中会给你一些Pass类去继承。你需要实现它的一些方法。最后使用LLVM的编译器会把它翻译得到的IR传入Pass里，给你遍历和修改。

&emsp;&emsp;LLVM Pass的用处：
> 1. 插桩，在Pass遍历LLVM IR的同时，往里面插入新的代码。
>
> 2. 机器无关的代码优化：IR在被翻译成机器码前会做一些机器无关的优化。但是不同的优化方法之间需要解耦，所以自然要各自遍历一遍IR，实现成了一个个LLVM Pass。最终，基于LLVM的编译器会在前端生成LLVMIR后调用一些LLVM Pass做机器无关优化，然后再调用LLVM后端生成目标平台代码。
>
> 3. 静态分析：像VSCode的C/C++插件就会用LLVM Pass来分析代码，提示可能的错误(无用的变量、无法到达的代码等等)。




## 3.跳转基本块相关应用分析

&emsp;&emsp;程序分析是对软件缺陷采用自动化工具进行分析，相对于程序测试的手动测试，采用这种方式可以提高查找软件缺陷的效率。根据分析方法不同可以分为程序静态分析和程序动态分析，它们各有优缺点。  

&emsp;&emsp;程序静态分析近些年在学术界和工业界研究较多，也有部分成熟的产品，包括Coverity Prevent, Klockwork k7等。程序静态分析不执行程序，而是通过对程序源代码或者经过源代码编译产生的中间代码进行分析，常用的分析方法包括：数据流分析、污点分析、符号执行和模型检测等方式。程序静态分析能够得到程序内部的数据流信息和控制流信息，分析结果具有较高的程序路径覆盖率和较低的漏报，但是某些变景的值只有在运行时冰确定，所以误报率比较高。程序静态分析更加偏向于白盒测试。  

&emsp;&emsp;程序动态分析目前使用较广，被广泛地用于程序漏洞挖掘方面。程序动态分析使用可执行文件作为输入，具体执行程序，通过有效的策略遍历执行程序的执行路径，发掘程序的缺陷。目前采用的方式有指令插桩、虚拟机模拟运行等方式。因为知道程序的变量值所以具有较低的误报率，但是不清楚程序内部具体结构，有一定的漏报。程序动态分析更加偏向于黑盒fuzz测试.


## 4.参考文献
